The insecure-registry config isn't being used because the certificate validation happens first. We need to **regenerate the certificate with SANs (Subject Alternative Names)**.

---

## Step 1: Stop Harbor

```bash
cd ~/software/harbor
docker-compose down
```

---

## Step 2: Remove Old Certificates

```bash
sudo rm -rf /home/ashraful/software/data/cert
sudo mkdir -p /home/ashraful/software/data/cert
cd /home/ashraful/software/data/cert
```

---

## Step 3: Create Certificate with SAN

### Create config file
```bash
sudo nano cert.conf
```

Paste this exactly:
```
[req]
distinguished_name = req_distinguished_name
req_extensions = v3_req
prompt = no

[req_distinguished_name]
C = BD
ST = Dhaka
L = Dhaka
O = MyCompany
CN = 36.255.69.72

[v3_req]
subjectAltName = DNS:36.255.69.72, IP:36.255.69.72, DNS:localhost, IP:127.0.0.1
```

Save: `Ctrl + X` ‚Üí `Y` ‚Üí `Enter`

---

## Step 4: Generate Certificate

```bash
sudo openssl req -new -x509 -nodes -days 365 -keyout harbor.key -out harbor.crt -config cert.conf
```

---

## Step 5: Set Permissions

```bash
sudo chmod 600 harbor.key
sudo chmod 644 harbor.crt
sudo chown -R $USER:$USER /home/ashraful/software/data
```

---

## Step 6: Verify Certificate has SAN

```bash
openssl x509 -in harbor.crt -text -noout | grep -A 2 "Subject Alternative Name"
```

Should show:
```
X509v3 Subject Alternative Name: 
    DNS:36.255.69.72, IP:36.255.69.72, DNS:localhost, IP:127.0.0.1
```

---

## Step 7: Regenerate Harbor Config

```bash
cd ~/software/harbor
sudo ./prepare
```

---

## Step 8: Restart Harbor

```bash
docker-compose up -d
```

Wait 15 seconds...

---

## Step 9: Verify All Containers Running

```bash
docker-compose ps
```

All should show **UP**.

---

## Step 10: Try Login Again

```bash
docker login -u admin -p 786Shuvooo 36.255.69.72:4433
```

Should now work:
```
Login Succeeded
```

---

## If Still Fails: Manually Trust Certificate

```bash
sudo cp /home/ashraful/software/data/cert/harbor.crt /usr/local/share/ca-certificates/harbor.crt
sudo update-ca-certificates
sudo systemctl restart docker
docker login -u admin -p 786Shuvooo 36.255.69.72:4433
```

---

## Quick Reference

```bash
# All steps in one block
cd /home/ashraful/software/data/cert
sudo rm -f harbor.key harbor.crt cert.conf

sudo nano cert.conf
# Copy the cert.conf content from above

sudo openssl req -new -x509 -nodes -days 365 -keyout harbor.key -out harbor.crt -config cert.conf
sudo chmod 600 harbor.key
sudo chmod 644 harbor.crt
sudo chown -R $USER:$USER /home/ashraful/software/data

cd ~/software/harbor
sudo ./prepare
docker-compose down
docker-compose up -d

# Wait 15 seconds, then test
docker login -u admin -p 786Shuvooo 36.255.69.72:4433
```

Run these steps and let me know! üîê
